---
title: "Song Analysis"
author: "Scott Onestak"
date: "9/28/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

#READ IN PACKAGES
```{r packages}
if (!require("dplyr")) install.packages("dplyr",dependencies = T)
if (!require("jsonlite")) installed.packages("jsonlite",dependencies = T)
if (!require("curl")) installed.packages("curl",dependencies = T)
if (!require("glue")) installed.packages("glue",dependencies = T)
if (!require("FactoMineR")) installed.packages("FactoMineR",dependencies = T)
if (!require("ggplot2")) installed.packages("ggplot2",dependencies = T)
if (!require("zoo")) installed.packages("zoo",dependencies = T)
if(!require('plotly')) install.packages('plotly',dependencies = T)


library(dplyr)
library(jsonlite)
library(curl)
library(glue)
library(FactoMineR)
library(ggplot2)
library(zoo)
library(plotly)

Sys.setenv("plotly_username"="sonestak")
Sys.setenv("plotly_api_key"="Qp9opKSaakBjxxvMK1DK")
```

#READ IN SONG DATASET
```{r read data}
songs_raw = read.csv('sonestak.csv',header=F,stringsAsFactors = F)
colnames(songs_raw) = c('Artist','Album','Track','Timestamp')
```

#CLEANING
```{r cleaning}
songs = songs_raw

#Grouping Same Songs Together
songs$Track[songs$Track =="starstrukk (feat. katyperry)"] = "Starstrukk (feat. Katy Perry)"
songs$Track[songs$Track == "The Chipmunk Song (Christmas Don't Be Late) - Remastered" | 
                songs$Track == "The Chipmunk Song (Christmas Don't Be Late) - Remastered 1999" ] = "The Chipmunk Song (Christmas Don't Be Late)"
songs$Track[songs$Track == "Be Our Guest - From Beauty and the Beast/Soundtrack" | 
                songs$Track == "Beauty and the Beast - From Beauty and the Beast/Soundtrack Version" ] = "Be Our Guest - From Beauty and the Beast"
songs$Track[songs$Track == "Cups (Pitch Perfectâ€™s â€œWhen Iâ€™m Goneâ€) - Pop Version" |
                songs$Track == "Cups (Pitch Perfectâ€™s â€œWhen Iâ€™m Goneâ€)"] = "Cups (Pitch Perfect's 'When I'm Gone')"
songs$Track[songs$Track == "Youâ€™ll Never Know"] = "You'll Never Know"
songs$Track[songs$Track == "I Could Be The One (Avicii Vs. Nicky Romero) - Nicktim / Radio Edit" |
                songs$Track == "I Could Be The One [Avicii vs Nicky Romero] - Nicktim - Radio Edit" |
                songs$Track == "I Could Be The One [Avicii vs Nicky Romero] - Nicktim / Radio Edit"] =
  "I Could Be The One (Avicii Vs. Nicky Romero) - Radio Edit"
songs$Artist[songs$Artist == "Axwell Î› Ingrosso" |
             songs$Artist == "Axwell / Ingrosso"] = "Axwell /\ Ingrosso"
songs$Track[songs$Track == "The Way I Are (Dance with Somebody) [feat. Lil Wayne]"] = "The Way I Are (Dance with Somebody)"
songs$Track[songs$Track == "Heaven Is A Place On Earth - 2009 Digital Remaster"] = "Heaven Is A Place on Earth"
songs$Artist[songs$Artist == "BeyoncÃ©"] = "Beyonce"
songs$Track[songs$Track == "Mony Mony - Downtown Mix / 24-Bit Digitally Remastered 2001"] = "Mony Mony - 24-Bit Digitally Remastered 01"
songs$Track[songs$Track == "Call Me - Digitally Remastered 98"] = "Call Me"
songs$Artist[songs$Artist == "Bobby 'Boris' Pickett"] = "Bobby Boris Pickett & The Crypt-Kickers"
songs$Track[songs$Track == "Rockin' Around The Christmas Tree - Single Version"] = "Rockin' Around The Christmas Tree"
songs$Track[songs$Track == "All This Time - Pop Mix"] = "All This Time"
songs$Track[songs$Track == "Be The Change - Radio Version"] = "Be the Change"
songs$Track[songs$Track == "Gold (Jason Nevins Rhythmic Radio) Remix"] = "Gold - Jason Nevins Rhythmic Remix/Bonus Track"
songs$Track[songs$Track == "Ready or Not - feat. Lecrae"] = "Ready or Not"
songs$Track[songs$Track == "Santa Claus Is Comin' to Town - C.W. Post College Greenvale NY - December 1975"] = "Santa Claus Is Comin' To Town - Single Version"
songs$Track[songs$Track == "A Holly Jolly Christmas - Single Version"] = "A Holly Jolly Christmas"
songs$Artist[songs$Artist == "CÃ©line Dion"] = "Celine Dion"
songs$Track[songs$Track == "Ashes - from the Deadpool 2 Motion Picture Soundtrack" |
            songs$Track == "Ashes - from Deadpool 2 Motion Picture Soundtrack"] = "Ashes - from Deadpool 2"
songs$Track[songs$Track == "Because You Loved Me (Theme from Up Close and Personal)"] = "Because You Loved Me"
songs$Track[songs$Track == "My Heart Will Go On - Love Theme From Titanic"] = "My Heart Will Go On"
songs$Track[songs$Track == "I Need Your Love (feat. Ellie Goulding)"] = "I Need Your Love"
songs$Track[songs$Track == "Outside (feat. Ellie Goulding)"] = "Outside"
songs$Track[songs$Track == "Eâ€¢MOâ€¢TION"] = "Emotion"
songs$Track[songs$Track == "I Didnâ€™t Just Come Here To Dance"] = "I Didn't Just Come Here To Dance"
songs$Track[songs$Track == "Letâ€™s Get Lost"] = "Let's Get Lost"
songs$Track[songs$Track == "Tonight Iâ€™m Getting Over You"] = "Tonight I'm Getting Over You"
songs$Track[songs$Track == "Tonight Iâ€™m Getting Over You - Reid Stefan Remix"] = "Tonight I'm Getting Over You - Reid Stefan Remix"
songs$Track[songs$Track == "Tonight Iâ€™m Getting Over You - Remix"] = "Tonight I'm Getting Over You - Remix"
songs$Artist[songs$Artist == "Carly Rae Jepsen | www.soundfox.co"] = "Carly Rae Jepsen"
songs$Track[songs$Track == "Circle Of Life - From The Lion King/Soundtrack" |
            songs$Track == "Circle of Life"] = "Circle of Life - From The Lion King"
songs$Track[songs$Track == "Ever Ever After - From Enchanted / Soundtrack Version"] = "Ever Ever After - Soundtrack"
songs$Track[songs$Track == "Make Your Own Kind Of Music - Remastered - Single Version"] = "Make Your Own Kind of Music"
songs$Track[songs$Track == "Sex (Cheat Codes X Kris Kross Amsterdam)"] = "Sex"
songs$Track[songs$Track == "Reflection - From Mulan / Pop Version" |
            songs$Track == "Reflection - Pop Version"] = "Reflection"
songs$Track[songs$Track == "We Remain - From â€œThe Hunger Games: Catching Fireâ€/ Soundtrack"] = "We Remain - From 'The Hunger Games: Catching Fire' Soundtrack"
songs$Track[songs$Track == "Canâ€™t Help Falling In Love - The Voice Performance"] = "Can't Help Falling In Love - The Voice Performance"
songs$Track[songs$Track == "Hold On Weâ€™re Going Home - The Voice Performance"] = "Hold On We're Going Home - The Voice Performance"
songs$Track[songs$Track == "I Wonâ€™t Give Up - The Voice Performance"] = "I Won't Give Up"
songs$Track[songs$Track == "When You Wish Upon a Star - From Pinocchio"] = "When You Wish Upon a Star"
songs$Track[songs$Track == "Dream Ghost (feat. Michael Hyatt Amber Riley & Ricki Lake)"] = "Dream Ghost"
songs$Track[songs$Track == "Gregâ€™s Drinking Song"] = "Greg's Drinking Song"
songs$Track[songs$Track == "Iâ€™m A Good Person" |
            songs$Track == "I'm a Good Person (feat. Rachel Bloom)"] = "I'm A Good Person"
songs$Artist[songs$Artist == "Ð’ÐµÑ€ÐºÐ° Ð¡ÐµÑ€Ð´ÑŽÑ‡ÐºÐ°"] = "Verka Serduchka"
songs$Track[songs$Track == "Hey Mama (feat. Nicki Minaj & Afrojack)"] = "Hey Mama (feat. Nicki Minaj Bebe Rexha & Afrojack)"
songs$Track[songs$Track == "Titanium"] = "Titanium (feat. Sia)"
songs$Track[songs$Track == "When Love Takes Over (feat. Kelly Rowland) - feat. Kelly Rowland"] = "When Love Takes Over (feat. Kelly Rowland)"
songs$Track[songs$Track == "Where Them Girls At - feat. Nicki Minaj & Flo Rida"] = "Where Them Girls At (feat. Nicki Minaj & Flo Rida)"
songs$Track[songs$Track == "Pour Some Sugar On Me - Remastered 2017"] = "You Spin Me Round (Like a Record)"
songs$Track[songs$Track == "Listen To Your Heart (EdmÃ©e's Unplugged Vocal)"] = "Listen To Your Heart (Edmee's Unplugged Vocal)"
songs$Track[songs$Track == "Cake By The Ocean - ã‚¯ãƒªãƒ¼ãƒ³ãƒ»ãƒ´ã‚¡ãƒ¼ã‚¸ãƒ§ãƒ³"] = "Cake by the Ocean"
songs$Track[songs$Track == "Stereo Love Featuring Vika Jigulina - Radio Edit"] = "Stereo Love - Radio Edit"
songs$Track[songs$Track == "Hanging On - Edit"] = "Hanging On"
songs$Track[songs$Track == "Still Falling For You - From Bridget Jones's Baby Original Motion Picture Soundtrack"] = "Still Falling For You - From Bridget Jones's Baby"
songs$Track[songs$Track == "Can You Feel The Love Tonight - End Title / From The Lion King"] = "Can You Feel the Love Tonight"
songs$Track[songs$Track == "When Iâ€™m Alone"] = "When I'm Alone"
songs$Track[songs$Track == "There You'll Be - Remastered Version"] = "There You'll Be - Remastered"
songs$Track[songs$Track == "Work from Home (feat. Ty Dolla $ign)" |
            songs$Track == "Work from Home"] = "Work From Home"
songs$Track[songs$Track == "100 Years: Music Video"] = "100 Years"
songs$Track[songs$Track == "Right Round - US"] = "Right Round"
songs$Track[songs$Track == "Say It"] = "Say It (feat. Tove Lo)"
songs$Track[songs$Track == "We Are Young (feat. Janelle MonÃ¡e) - feat. Janelle Monae" |
            songs$Track == "We Are Young (feat. Janelle MonÃ¡e)"] = "We Are Young (feat. Janelle Monae)"
songs$Track[songs$Track == "Saving Light"] = "Saving Light (feat. Haliene)"
songs$Track[songs$Track == "Feel Good (feat. Daya)"] = "Feel Good"
songs$Track[songs$Track == "I Got Nerve - From Hannah Montana/Soundtrack Version"] = "I Got Nerve"
songs$Track[songs$Track == "Nobody's Perfect - From Hannah Montana 2"] = "Nobody's Perfect"
songs$Track[songs$Track == "The Best of Both Worlds - From Hannah Montana/Soundtrack Version"] = "The Best of Both Worlds"
songs$Track[songs$Track == "The Other Side of Me - From Hannah Montana/Soundtrack Version"] = "The Other Side of Me"
songs$Track[songs$Track == "Christ Is Enough - Live"] = "Christ Is Enough"
songs$Artist[songs$Artist == "Hixxy"] = "Gareth Emery"
songs$Track[songs$Track == "Saving Light (Hixxy Remix) [feat. HALIENE]"] = "Saving Light - Hixxy Remix"
songs$Track[songs$Track == "Black Widow (feat. Rita Ora) - Clean Edit"] = "Black Widow"
songs$Artist[songs$Artist == "Jason DerÃ¼lo"] = "Jason Derulo"
songs$Track[songs$Track == "Flashlight - From Pitch Perfect 2 Soundtrack"] = "Flashlight - From Pitch Perfect 2"
songs$Track[songs$Track == "Part Of Your World - From The Little Mermaid/ Soundtrack Version"] = "Part of Your World - From The Little Mermaid / Soundtrack Version"
songs$Track[songs$Track == "Happy Xmas (War Is Over) - Remastered"] = "Happy Xmas (War Is Over) - 2010 Digital Remaster"
songs$Artist[songs$Artist == "John Martyn"] = "John Martin"
songs$Track[songs$Track == "St. Elmos Fire [Man In Motion]"] = "St. Elmo's Fire (Man in Motion)"
songs$Track[songs$Track == "It's Beginning To Look Like Christmas"] = "It's Beginning to Look a Lot Like Christmas"
songs$Track[songs$Track == "Too Little Too Late - Radio Version"] = "Too Little Too Late"
songs$Artist[songs$Artist == "JosÃ© Feliciano"] = "Jose Feliciano"
songs$Track[songs$Track == "Can You Feel The Love Tonight - From The Lion King/Soundtrack Version"] = "Can You Feel the Love Tonight"
songs$Track[songs$Track == "Angels We Have Heard On High (with Brian McKnight)"] = "Angels We Have Heard On High - Duet With Brian Mcknight"
songs$Track[songs$Track == "O Come All Ye Faithful (With The Mormon Tabernacle Choir under the direction of Craig Jessop) - with The Mormon Tabernacle Choir under the direction of Craig Jessop Album Version" | 
            songs$Track == "O Come All Ye Faithful - with The Mormon Tabernacle Choir under the direction of Craig Jessop"] = "O Come All Ye Faithful (with The Mormon Tabernacle Choir under the direction of Craig Jessop)"
songs$Track[songs$Track == "The First NoÃ«l - duet with Faith Hill" | 
            songs$Track == "The First NoÃ«l (with Faith Hill) - duet with Faith Hill Album Version"] = "The First Noel - Duet With Faith Hill"
songs$Track[songs$Track == "California Gurls - feat. Snoop Dogg"] = "California Gurls (feat. Snoop Dogg)"
songs$Track[songs$Track == "Dark Horse (feat. Juicy J)"] = "Dark Horse"
songs$Track[songs$Track == "E.T. - feat. Kanye West"] = "	E.T."
songs$Track[songs$Track == "Heartbeat Song - Dave AudÃ© Radio Mix"] = "Heartbeat Song - Dave Aude Radio Mix"
songs$Track[songs$Track == "Carry Me (feat. Julia Michaels)"] = "Carry Me"
songs$Track[songs$Track == "It Ainâ€™t Me (with Selena Gomez)"] = "It Ain't Me"
songs$Track[songs$Track == "ScheiÃŸe"] = "Scheibe"
songs$Track[songs$Track == "Shallow - Radio Edit"] = "Shallow"
songs$Track[songs$Track == "Telephone (feat. BeyoncÃ©)"] = "Telephone (feat. Beyonce)"
songs$Track[songs$Track == "YoÃ¼ and I"] = "You and I"
songs$Track[songs$Track == "Summertime Sadness (Lana Del Rey Vs. Cedric Gervais) - Cedric Gervais Remix" |
            songs$Track == "Summertime Sadness [Lana Del Rey vs. Cedric Gervais] - Cedric Gervais Remix"] = "Summertime Sadness (Lana Del Rey Vs. Cedric Gervais) - Cedric Gervais Remix / Radio Edit"
songs$Track[songs$Track == "A Whole New World - From Aladdin/ Soundtrack Version"] = "A Whole New World"
songs$Track[songs$Track == "God Bless The U.S.A. - Re-Recorded In Stereo" |
            songs$Track == "God Bless The U.S.A."] = "God Bless the USA"
songs$Track[songs$Track == "Longer Than I Thought (feat. Joe Jonas)"] = "Longer Than I Thought"
songs$Track[songs$Track == "Too Far Gone (feat. Anna Clendening)"] = "Too Far Gone"
songs$Track[songs$Track == "Dominick the Donkey (The Italian Christmas Donkey)"] = "Dominick The Italian Christmas Donkey"
songs$Track[songs$Track == "What A Wonderful World - Single Version"] = "What a Wonderful World"
songs$Track[songs$Track == "Bad Things - With Camila Cabello"] = "Bad Things"
songs$Track[songs$Track == "I Won't Let You Walk Away (feat. Madison Beer) - Lost Kings Remix"] = "I Won't Let You Walk Away - Lost Kings Remix"
songs$Track[songs$Track == "I Won't Let You Walk Away (feat. Madison Beer) - Radio Edit" |
            songs$Track == "I Won't Let You Walk Away (feat. Madison Beer) - Pop Radio Edit"] = "I Won't Let You Walk Away - Radio Edit"
songs$Artist[songs$Artist == "Marina & the Diamonds"] = "Marina"
songs$Track[songs$Track == "She Will Be Loved - Radio Mix"] = "She Will Be Loved"
songs$Artist[songs$Artist == "MGM Studio Orchestra"] = "MGM Studio Chorus"
songs$Artist[songs$Artist == "Molly SandÃ©n"] = "Molly Sanden"
songs$Track[songs$Track == "O Tannenbaum - Remastered 1999"] = "O Tannenbaum"
songs$Track[songs$Track == "Hakuna Matata - From The Lion King/Soundtrack"] = "Hakuna Matata"
songs$Artist[songs$Artist == "Owl City & Carly Rae Jepsen"] = "Owl City"
songs$Track[songs$Track == "Youâ€™re Not Alone"] = "You're Not Alone"
songs$Track[songs$Track == "Can We Pretend (feat. Cash Cash)"] = "Can We Pretend"
songs$Track[songs$Track == "Thereâ€™s A Honey"] = "There's A Honey"
songs$Track[songs$Track == "Hit Me With Your Best Shot - 1999 Digital Remaster"] = "Hit Me With Your Best Shot"
songs$Track[songs$Track == "You'll Be In My Heart (Phil Version) - ã€Žã‚¿ãƒ¼ã‚¶ãƒ³ã€ã‚ˆã‚Š" |
            songs$Track == "You'll Be In My Heart - From Tarzan/Soundtrack Version" |
            songs$Track == "You Will Be In My Heart"] = "You'll Be In My Heart"
songs$Track[songs$Track == "QuÃ© Sera Sera"] = "Que Sera Sera"
songs$Artist[songs$Artist == "Raven-SymonÃ©"] = "Raven-Symone"
songs$Track[songs$Track == "We Found Love (Album Version) [Feat. Calvin Harris]"] = "We Found Love (feat. Calvin Harris)"
songs$Track[songs$Track == "Go the Distance - ã€Žãƒ˜ãƒ©ã‚¯ãƒ¬ã‚¹ã€ã‚ˆã‚Š" |
            songs$Track == "Go the Distance - From Hercules / Soundtrack Version" |
            songs$Track == "Go The Distance - From Hercules/Soundtrack"] = "Go The Distance"
songs$Track[songs$Track == "Under the Sea - From The Little Mermaid / Soundtrack Version" |
            songs$Track == "Under the Sea - From The Little Mermaid"] = "Under The Sea - From The Little Mermaid/ Soundtrack Version"
songs$Track[songs$Track == "When She Loved Me - From Toy Story 2/Soundtrack Version" |
            songs$Track == "When She Loved Me - From Toy Story 2"] = "When She Loved Me"
songs$Track[songs$Track == "Back To You - From 13 Reasons Why â€“ Season 2 Soundtrack"] = "Back To You"
songs$Track[songs$Track == "Donâ€™t Leave"] = "Don't Leave"
songs$Track[songs$Track == "First Time (feat. Dylan Matthew)"] = "First Time"
songs$Track[songs$Track == "Easy Love - Original Mix"] = "Easy Love"
songs$Track[songs$Track == "Sweet Lovin' - Original Mix" |
            songs$Track == "Sweet Lovin' - Radio Edit"] = "Sweet Lovin'"
songs$Track[songs$Track == "All My Friends (feat. Tinashe & Chance The Rapper)"] = "All My Friends"
songs$Track[songs$Track == "Live Love Learn (feat. Peg Parnevik)"] = "Live Love Learn"
songs$Track[songs$Track == "Wannabe - Radio Edit"] = "Wannabe"
songs$Track[songs$Track == "I Won't Say (I'm In Love) - ã€Žãƒ˜ãƒ©ã‚¯ãƒ¬ã‚¹ã€ã‚ˆã‚Š" |
            songs$Track == "I Won't Say (I'm In Love) - From Hercules"] = "I Won't Say (I'm In Love)"
songs$Track[songs$Track == "Don't You Worry Child (Radio Edit) [feat. John Martin]" |
            songs$Track == "Don't You Worry Child (Radio Edit)"] = "Don't You Worry Child - Radio Edit"
songs$Track[songs$Track == "...Ready for It?"] = "... Ready For It?"
songs$Track[songs$Track == "Bellas Finals: Price Tag/Donâ€™t You (Forget About Me)/Give Me Everything/Just The Way You Are/Party In The U.S.A./Turn The Beat Around"] = "Bellas Finals: Price Tag/Don't You (Forget About Me)/Give Me Everything/Just The Way You Are/Party In The U.S.A./Turn The Beat Around"
songs$Track[songs$Track == "Cups (â€œWhen Iâ€™m Goneâ€) - Campfire Version"] = "Cups ('When I'm Gone') - Campfire Version"
songs$Track[songs$Track == "Riff Off: Mickey/Like A Virgin/Hit Me With Your Best Shot/S&M/Letâ€™s Talk About Sex/Iâ€™ll Make Love To You/Feels Like The First Time/No Diggity"] = "Riff Off: Mickey/Like A Virgin/Hit Me With Your Best Shot/S&M/Let's Talk About Sex/I'll Make Love To You/Feels Like The First Time/No Diggity"
songs$Track[songs$Track == "Do You Mean (with Ty Dolla $ign & bÃ¼low)"] = "Do You Mean"
songs$Track[songs$Track == "Side Effects (feat. Emily Warren)"] = "Side Effects"
songs$Track[songs$Track == "Takeaway"] = "Takeaway (with ILLENIUM & Lennon Stella)"
songs$Track[songs$Track == "Our Lips Are Sealed - Single Version"] = "Our Lips Are Sealed"
songs$Track[songs$Track == "We Got The Beat - Single Mix"] = "We Got the Beat"
songs$Artist[songs$Artist == "TiÃ«sto"] = "Tiesto"
songs$Track[songs$Track == "Iâ€™m Me"] = "I'm Me"
songs$Track[songs$Track == "Another Shotâ€¬â€¬â€¬"] = "Another Shot"
songs$Track[songs$Track == "Weâ€™re The Same"] = "We're the Same"
songs$Track[songs$Track == "	I Have Nothing - Remastered"] = "I Have Nothing"
songs$Track[songs$Track == "The Star Spangled Banner (feat. The Florida Orchestra) - Live from Super Bowl XXV"] = "The Star Spangled Banner - Live from Super Bowl XXV"
songs$Track[songs$Track == "Clarity - feat. Foxes"] = "Clarity"
songs$Track[songs$Track == "Happy Now (with Elley DuhÃ©)"] = "Happy Now"
songs$Track[songs$Track == "I Want You to Know (feat. Selena Gomez)"] = "I Want You to Know"
songs$Artist[songs$Artist == "D.H.T."] = "DHT"
songs$Track[songs$Track == "Listen to Your Heart (featuring Edmee) - Furious F. EZ Radio Edit"] = "Listen To Your Heart (Furious F. EZ Radio Edit)"
songs$Track[songs$Track == "You Are Loved (Don't Give Up) - Don't Give Up Album Version"] = "You Are Loved (Don't Give Up)"
songs$Artist[songs$Artist == "Joshua Coleman"] = "Fifth Harmony"
songs$Track[songs$Track == " I Won't Say (I'm In Love)"] = "I Won't Say (I'm In Love)"
songs$Track[songs$Track == "Friday Nightâ€¬â€¬â€¬"] = "Friday Night"
songs$Track[songs$Track == "I Have Nothing - Remastered"] = "I Have Nothing"
songs$Track[songs$Track == "Ashes - from Deadpool 2"] = "Ashes"
songs$Artist[songs$Artist == "Emeli SandÃ©"] = "Emeli Sande"
songs$Track[songs$Track == "Anywhere For You"] = "Anywhere For You - Radio Edit"
songs$Track[songs$Track == "You Keep Me Hangin' On"] = "You Keep Me Hangin On"
songs$Artist[songs$Artist == "Bethel Music"] = "Kristene DiMarco"
songs$Artist[songs$Artist == "Mama Cass"] = "Cass Elliot"
songs$Track[songs$Track == "Jump - 2015 Remastered Version"] = "Jump"

#Changing Search Song Title
songs$Track[songs$Track == "Respect - Remastered"] = "Respect"
songs$Track[songs$Track == "Mony Mony - 24-Bit Digitally Remastered 01"] = "Mony Mony"


distincts = songs %>% 
  group_by(Artist,Track) %>%
  summarize(streams = n())

qualifying = distincts %>% 
  filter(streams >= 5) %>%
  filter(Artist != "Amy Guess") %>% #Doesn't Exist
  filter(Track != "Almost Said It") %>% #Not in US Market
  filter(Track != "Love Again") %>% #Not in US Market
  filter(Track != "Anyone Of Us (Stupid Mistake)") %>%
  filter(Track != "Goodness Gracious - The Chainsmokers Extended Remix") %>% #Not available anymore
  filter(Artist != "f(x)") %>%
  filter(Track != "Hawaiian Roller Coaster Ride - From Lilo & Stitch/Soundtrack Version") %>% #Causing problems for lookup
  filter(Artist != "Rachel Bloom") %>% #Comedy
  filter(Artist != "Rockie Gold") %>% #Comedy
  filter(Track != "I2I") %>% #No Longer Available
  filter(Track != "We're the Same") %>% #Can't Find It
  filter(Artist != "Crazy Ex-Girlfriend Cast") #Comedy

qsongs = songs %>% 
  inner_join(.,qualifying,by=c("Artist","Track")) %>% 
  select(-c(streams)) 
```

#CREATE LIST FOR SPOTIFY LOOKUP
```{r create lookup,results='hide'}
#Change Artist Name For Lookup ---> Problem with escape characters in string
qualifying$Artist[qualifying$Artist == "Axwell /\\ Ingrosso"] = "Axwell Ingrosso"
qualifying$Artist[qualifying$Artist == "Aly & AJ"] = "Aly AJ"
qualifying$Artist[qualifying$Artist == "Earth Wind & Fire"] = "Earth Wind Fire"

song_lookup = qualifying %>%
  mutate(temp=paste(Artist,Track,Sep=" ")) %>%
  mutate(temp2=gsub("'","",temp)) %>%
  mutate(Lookup=gsub(" ","%20",temp2)) %>%
  select(-c(temp,temp2))
song_lookup$id = NA

#Change Artist Name Back
qualifying$Artist[qualifying$Artist == "Axwell Ingrosso"] = "Axwell /\\ Ingrosso"
song_lookup$Artist[song_lookup$Artist == "Axwell Ingrosso"] = "Axwell /\\ Ingrosso"
qualifying$Artist[qualifying$Artist == "Aly AJ"] = "Aly & AJ"
song_lookup$Artist[song_lookup$Artist == "Aly AJ"] = "Aly & AJ"
qualifying$Artist[qualifying$Artist == "Earth Wind Fire"] = "Earth Wind & Fire"
song_lookup$Artist[song_lookup$Artist == "Earth Wind Fire"] = "Earth Wind & Fire"

#Change Lookup String
song_lookup$Lookup[song_lookup$Lookup == "Britt%20Nicole%20Gold%20-%20Jason%20Nevins%20Rhythmic%20Remix/Bonus%20Track%20%20"] = "Britt%20Nicole%20Gold%20Jason%20Nevins"
song_lookup$Lookup[song_lookup$Lookup == "Carly%20Rae%20Jepsen%20I%20Didnt%20Just%20Come%20Here%20To%20Dance%20%20"] = "Carly%20Rae%20Jepsen%20I%20Just%20Come%20Here%20To%20Dance"
song_lookup$Lookup[song_lookup$Lookup == "Carly%20Rae%20Jepsen%20Lets%20Get%20Lost%20%20"] = "Carly%20Rae%20Jepsen%20Get%20Lost"
song_lookup$Lookup[song_lookup$Lookup == "Celine%20Dion%20Beauty%20and%20the%20Beast%20-%20Duet%20with%20Peabo%20Bryson%20from%20the%20Soundtrack%20Beauty%20and%20the%20Beast%20%20"] = "Celine%20Dion%20Beauty%20and%20the%20Beast"
song_lookup$Lookup[song_lookup$Lookup == "Christina%20Grimmie%20Cant%20Help%20Falling%20In%20Love%20-%20The%20Voice%20Performance%20%20"] = "Christina%20Grimmie%20Help%20Falling%20In%20Love"
song_lookup$Lookup[song_lookup$Lookup == "Christina%20Grimmie%20Hold%20On%20Were%20Going%20Home%20-%20The%20Voice%20Performance%20%20"] = "Christina%20Grimmie%20Hold%20On%20Going%20Home%20-%20The%20Voice%20Performance%20%20"
song_lookup$Lookup[song_lookup$Lookup == "David%20Guetta%20She%20Wolf%20(Falling%20to%20Pieces)%20[feat.%20Sia]%20%20"] = "David%20Guetta%20She%20Wolf"
song_lookup$Lookup[song_lookup$Lookup == "Dead%20or%20Alive%20You%20Spin%20Me%20Round%20(Like%20a%20Record)%20%20"] = "Dead%20or%20Alive%20You%20Spin%20Me%20Round"
song_lookup$Lookup[song_lookup$Lookup == "Def%20Leppard%20Pour%20Some%20Sugar%20On%20Me%20(2012)%20%20"] = "Def%20Leppard%20Pour%20Some%20Sugar%20On%20Me"
song_lookup$Lookup[song_lookup$Lookup == "Eurythmics%20Sisters%20Are%20Doin%20It%20for%20Themselves%20(Than%20Never%20to%20Have%20Loved)%20%20"] = "Eurythmics%20Sisters%20Are%20It%20for%20Themselves"
song_lookup$Lookup[song_lookup$Lookup == "Fergie%20M.I.L.F.%20$%20%20"] = "Fergie%20M.I.L.F."
song_lookup$Lookup[song_lookup$Lookup == "Fergie%20L.A.LOVE%20(la%20la)%20%20"] = "Fergie%20L.A.LOVE"
song_lookup$Lookup[song_lookup$Lookup == "Gareth%20Emery%20Saving%20Light%20(feat.%20Haliene)%20%20"] = "Gareth%20Emery%20Saving%20Light"
song_lookup$Lookup[song_lookup$Lookup == "Gayla%20Peevey%20I%20Want%20a%20Hippopotamus%20for%20Christmas%20(Hippo%20the%20Hero)%20%20"] = "Gayla%20Peevey%20I%20Want%20a%20Hippopotamus%20for%20Christmas"
song_lookup$Lookup[song_lookup$Lookup == "Jason%20Weaver%20I%20Just%20Cant%20Wait%20To%20Be%20King%20-%20From%20The%20Lion%20King/Soundtrack%20Version%20%20	"] = "Jason%20Weaver%20I%20Just%20Wait%20To%20Be%20King"
song_lookup$Lookup[song_lookup$Lookup == "Jermaine%20Stewart%20We%20Dont%20Have%20To%20Take%20Our%20Clothes%20Off%20-%207%20Version%20%20"] = "Jermaine%20Stewart%20We%20Dont%20Have%20To%20Take%20Our%20Clothes%20Off"
song_lookup$Lookup[song_lookup$Lookup == "John%20Lennon%20Happy%20Xmas%20(War%20Is%20Over)%20-%202010%20Digital%20Remaster%20%20"] = "John%20Lennon%20Happy%20Xmas"
song_lookup$Lookup[song_lookup$Lookup == "John%20Parr%20St.%20Elmos%20Fire%20(Man%20in%20Motion)%20%20"] = "John%20Parr%20St.%20Elmos%20Fire"
song_lookup$Lookup[song_lookup$Lookup == "Josh%20Groban%20All%20I%20Ask%20Of%20You%20(duet%20with%20Kelly%20Clarkson)%20-%20From%20The%20Phantom%20Of%20The%20Opera%20%20"] = "Josh%20Groban%20All%20I%20Ask%20Of%20You"
song_lookup$Lookup[song_lookup$Lookup == "Josh%20Groban%20Angels%20We%20Have%20Heard%20On%20High%20-%20Duet%20With%20Brian%20Mcknight%20%20"] = "Josh%20Groban%20Angels%20We%20Have%20Heard%20On%20High"
song_lookup$Lookup[song_lookup$Lookup == "Josh%20Groban%20O%20Come%20All%20Ye%20Faithful%20(with%20The%20Mormon%20Tabernacle%20Choir%20under%20the%20direction%20of%20Craig%20Jessop)%20%20"] = "Josh%20Groban%20O%20Come%20All%20Ye%20Faithful"
song_lookup$Lookup[song_lookup$Lookup == "Josh%20Groban%20The%20First%20Noel%20-%20Duet%20With%20Faith%20Hill%20%20"] = "Josh%20Groban%20The%20First%20Noel"
song_lookup$Lookup[song_lookup$Lookup == "Katy%20Perry%20California%20Gurls%20(feat.%20Snoop%20Dogg)%20%20"] = "Katy%20Perry%20California%20Gurls"
song_lookup$Lookup[song_lookup$Lookup == "Genesis%20Invisible%20Touch%20-%202007%20Remastered%20Version%20%20"] = "Genesis%20Invisible%20Touch"
song_lookup$Lookup[song_lookup$Lookup == "Havana%20Brown%20We%20Run%20The%20Night%20-%20Edited%20%20"] = "Havana%20Brown%20We%20Run%20The%20Night"
song_lookup$Lookup[song_lookup$Lookup == "Idina%20Menzel%20Let%20It%20Go%20-%20From%20Frozen/Soundtrack%20Version%20%20"] = "Idina%20Menzel%20Let%20It%20Go"
song_lookup$Lookup[song_lookup$Lookup == "Hannah%20Montana%20Rockstar%20-%20Original%20Version%20%20"] = "Hannah%20Montana%20Rockstar"
song_lookup$Lookup[song_lookup$Lookup == "Macklemore%20&%20Ryan%20Lewis%20Thrift%20Shop%20(feat.%20Wanz)%20%20"] = "Macklemore%20&%20Ryan%20Lewis%20Thrift%20Shop"
song_lookup$Lookup[song_lookup$Lookup == "Mako%20I%20Wont%20Let%20You%20Walk%20Away%20-%20Radio%20Edit%20%20"] = "Mako%20I%20Let%20You%20Walk%20Away"
song_lookup$Lookup[song_lookup$Lookup == "Mako%20I%20Wont%20Let%20You%20Walk%20Away%20-%20Lost%20Kings%20Remix%20%20"] = "Mako%20I%20Let%20You%20Walk%20Away%20Lost%20Kings"
song_lookup$Lookup[song_lookup$Lookup == "Mannheim%20Steamroller%20God%20Rest%20Ye%20Merry%20Gentlemen%20-%20Rock%20Version%20%20"] = "Mannheim%20Steamroller%20God%20Rest%20Ye%20Merry%20Gentlemen%20"
song_lookup$Lookup[song_lookup$Lookup == "Mannheim%20Steamroller%20Lo%20How%20A%20Rose%20Eer%20Blooming%20%20"] = "Mannheim%20Steamroller%20Lo%20How%20A%20Rose%20Blooming%20%20"
song_lookup$Lookup[song_lookup$Lookup == "Owl%20City%20Good%20Time%20-%20Wideboys%20Remix%20[Club]%20%20"] = "Owl%20City%20Good%20Time%20-%20Wideboys%20Remix"
song_lookup$Lookup[song_lookup$Lookup == "Matt%20Redman%2010000%20Reasons%20(Bless%20the%20Lord)%20-%20Live%20%20"] = "Matt%20Redman%20Reasons"
song_lookup$Lookup[song_lookup$Lookup == "Phil%20Collins%20You%20Cant%20Hurry%20Love%20-%202016%20Remastered%20%20"] = "Phil%20Collins%20You%20Cant%20Hurry%20Love"
song_lookup$Lookup[song_lookup$Lookup == "Pierce%20Fulton%20Kuaga%20(Lost%20Time)%20(Radio%20Edit)%20%20"] = "Pierce%20Fulton%20Kuaga"
song_lookup$Lookup[song_lookup$Lookup == "Queen%20Dont%20Stop%20Me%20Now%20-%20Remastered%20%20"] = "Queen%20Dont%20Stop%20Me%20Now"
song_lookup$Lookup[song_lookup$Lookup == "Samuel%20E.%20Wright%20Under%20The%20Sea%20-%20From%20The%20Little%20Mermaid/%20Soundtrack%20Version%20%20"] = "Samuel%20Wright%20Under%20The%20Sea"
song_lookup$Lookup[song_lookup$Lookup == "Rachel%20Platten%201000%20Ships%20%20"] = "Rachel%20Platten%20Ships"
song_lookup$Lookup[song_lookup$Lookup == "RedOne%20Dont%20You%20Need%20Somebody%20(feat.%20Enrique%20Iglesias%20R.%20City%20Serayah%20&%20Shaggy)%20%20"] = "RedOne%20Dont%20You%20Need%20Somebody"
song_lookup$Lookup[song_lookup$Lookup == "Rihanna%20Love%20The%20Way%20You%20Lie%20(Part%20II)%20-%20Pt.%202%20%20"] = "Rihanna%20Love%20The%20Way%20You%20Lie"
song_lookup$Lookup[song_lookup$Lookup == "Raven-Symone%20Thats%20So%20Raven%20(Theme%20Song)%20%20"] = "Raven-Symone%20So%20Raven"
song_lookup$Lookup[song_lookup$Lookup == "Rufus%20The%20Naked%20Mole%20Rap%20-%20From%20Kim%20Possible%20%20"] = "Rufus%20The%20Naked%20Mole%20Rap"
song_lookup$Lookup[song_lookup$Lookup == "Susan%20Egan%20I%20Wont%20Say%20(Im%20In%20Love)%20%20"] = "Susan%20Egan%20I%20Wont%20Say"
song_lookup$Lookup[song_lookup$Lookup == "Nicole%20Scherzinger%20Dont%20Hold%20Your%20Breath"] = "Nicole%20Scherzinger%20Hold%20Your%20Breath"
song_lookup$Lookup[song_lookup$Lookup == "The%20Barden%20Bellas%20Bellas%20Finals:%20Price%20Tag/Dont%20You%20(Forget%20About%20Me)/Give%20Me%20Everything/Just%20The%20Way%20You%20Are/Party%20In%20The%20U.S.A./Turn%20The%20Beat%20Around%20%20"] = "The%20Barden%20Bellas%20Bellas%20Finals"
song_lookup$Lookup[song_lookup$Lookup == "The%20Barden%20Bellas%20Bellas%20Regionals:%20The%20Sign/Eternal%20Flame/Turn%20The%20Beat%20Around%20%20"] = "The%20Barden%20Bellas%20Bellas%20Regionals"
song_lookup$Lookup[song_lookup$Lookup == "The%20Barden%20Bellas%20Cups%20(When%20Im%20Gone)%20-%20Campfire%20Version%20%20"] = "The%20Barden%20Bellas%20Cups"
song_lookup$Lookup[song_lookup$Lookup == "The%20Barden%20Bellas%20Pool%20Mashup:%20Just%20The%20Way%20You%20Are/Just%20A%20Dream%20%20"] = "The%20Barden%20Bellas%20Pool"
song_lookup$Lookup[song_lookup$Lookup == "The%20Disney%20Afternoon%20Studio%20Chorus%20Chip%20N%20Dales%20Rescue%20Rangers%20Theme%20Song%20-%20From%20Chip%20n%20Dales%20Rescue%20Rangers%20%20"] = "The%20Disney%20Afternoon%20Studio%20Chorus%20Chip%20N%20Dales%20Rescue%20Rangers"
song_lookup$Lookup[song_lookup$Lookup == "The%20Disney%20Afternoon%20Studio%20Chorus%20Duck%20Tales%20Theme%20-%20From%20Duck%20Tales%20%20"] = "The%20Disney%20Afternoon%20Studio%20Chorus%20Duck%20Tales"
song_lookup$Lookup[song_lookup$Lookup == "The%20J.%20Geils%20Band%20Centerfold%20-%202006%20-%20Remaster%20%20"] = "The%20J.%20Geils%20Band%20Centerfold"
song_lookup$Lookup[song_lookup$Lookup == "Thomas%20Helmore%20A%20Christmas%20Festival%20Medley:%20Joy%20To%20The%20World%20/%20Deck%20The%20Halls%20/%20Good%20King%20Wenceslas%20/%20God%20Rest%20Ye%20Merry%20Gentlemen%20/%20Hark!%20The%20Herald%20Angels%20Sing%20/%20The%20First%20Noel%20/%20Silent%20Night%20/%20Jingle%20Bells%20/%20O%20Come%20All%20Ye%20Faithful%20%20"] = "Thomas%20Helmore%20A%20Christmas%20Festival"
song_lookup$Lookup[song_lookup$Lookup == "Tori%20Kelly%20Colors%20Of%20The%20Wind%20-%20From%20Pocahontas%20%20"] = "Tori%20Kelly%20Colors%20Of%20The%20Wind"
song_lookup$Lookup[song_lookup$Lookup == "Two%20Friends%20Brighter%20(feat.%20Jeff%20Sontag%20&%20I%20Am%20Lightyear)%20[Radio%20Edit]%20%20"] = "Two%20Friends%20Brighter"
song_lookup$Lookup[song_lookup$Lookup == "tyDi%20Redefined%20(feat.%20Melanie%20Fontana%20&%20Novaspace)%20[Club%20Edit]%20%20"] = "tyDi%20Redefined"
song_lookup$Lookup[song_lookup$Lookup == "Van%20Halen%20Jump%20-%202015%20Remastered%20Version%20%20"] = "Van%20Halen%20Jump"
song_lookup$Lookup[song_lookup$Lookup == "Van%20McCoy%20The%20Hustle%20-%20Original%20Mix%20%20"] = "Van%20McCoy%20The%20Hustle"
song_lookup$Lookup[song_lookup$Lookup == "The%20Chainsmokers%20Takeaway%20(with%20ILLENIUM%20&%20Lennon%20Stella)%20%20"] = "The%20Chainsmokers%20Takeaway"
song_lookup$Lookup[song_lookup$Lookup == "Vigiland%20Were%20the%20Same%20%20"] = "Vigiland%20Same"
song_lookup$Lookup[song_lookup$Lookup == "Vince%20Guaraldi%20Trio%20Christmas%20Time%20Is%20Here%20-%20Vocal%20%20"] = "Vince%20Guaraldi%20Trio%20Christmas%20Time%20Is%20Here"
song_lookup$Lookup[song_lookup$Lookup == "Whitney%20Houston%20I%20Wanna%20Dance%20with%20Somebody%20(Who%20Loves%20Me)%20%20"] = "Whitney%20Houston%20I%20Wanna%20Dance%20with%20Somebody"
song_lookup$Lookup[song_lookup$Lookup == "Whitney%20Houston%20The%20Star%20Spangled%20Banner%20-%20Live%20from%20Super%20Bowl%20XXV%20%20"] = "Whitney%20Houston%20The%20Star%20Spangled%20Banner"
song_lookup$Lookup[song_lookup$Lookup == "Zara%20Larsson%20Aint%20My%20Fault%20%20"] = "Zara%20Larsson%20My%20Fault%20%20"
song_lookup$Lookup[song_lookup$Lookup == "Earth%20Wind%20Fire%20Lets%20Groove%20%20"] = "Earth%20Wind%20Fire%20Groove%20%20"

```

#USE LOOKUP FIELD TO HIT SPOTIFY API SERVER
## Can get OAuth_Token at: https://developer.spotify.com/console/get-search-item/?q=Carly%20Rae%20Jepsen%20Run%20Away%20With%20Me&type=track&market=&limit=1&offset=
```{r get those ids}
OAuth_Token = "BQC9ctUBB_OHLjcjjE3Gyf8UUPb9JiK7yUuhx1xdmbthydW60JjasLfHCd7mOZRXE60jWzSGBA6XGmd7co04vWcWyzZYDDlZke-_90v6U6SNUgbNP7gJmIAfNRYopa8ZQh6x4HlELvT0j-hHv99PVHcLcX0I6Q"

for(i in seq(1:dim(song_lookup)[1])){
  
  theLookup = song_lookup[i,"Lookup"]
  temp = glue('\'curl -X "GET" "https://api.spotify.com/v1/search?q={theLookup}&type=track&limit=1" -H "Accept: application/json" -H "Content-Type: application/json" -H "Authorization: Bearer {OAuth_Token}"\'')
  song_lookup[i,"id"] = fromJSON(system(substr(temp,2,nchar(temp)-1),inter=T,ignore.stderr = T))$tracks$items$id
}

#Manual Override - mapping to wrong id (such as title tracks of albums or studio v live version)
#CHECK - No Duplicates
song_lookup[song_lookup$Artist=="Carly Rae Jepsen" & song_lookup$Track=="Emotion","id"] = "6f8dVDn1vWbWIfUouv9iJp"
song_lookup[song_lookup$Artist=="Carrie Underwood" & song_lookup$Track=="Some Hearts","id"] = "4VsMvUldyABTPUodYRI6uX"
song_lookup[song_lookup$Artist=="Ellie Goulding" & song_lookup$Track=="Halcyon","id"] = "5f1BYfuMovgQPuYPIGfESE"
song_lookup[song_lookup$Artist=="Jessie J" & song_lookup$Track=="Who You Are","id"] = "65lIGCfW59BxcEJnnIOCq3"
song_lookup[song_lookup$Artist=="Karmin" & song_lookup$Track=="Pulses","id"] = "7lHkU78B86mdBbU0WIVswi"
song_lookup[song_lookup$Artist=="Kelly Clarkson" & song_lookup$Track=="Breakaway","id"] = "61Qhe2mHSLhUE04QeK4lkD"
song_lookup[song_lookup$Artist=="Kelly Clarkson" & song_lookup$Track=="Piece by Piece","id"] = "2NELtMgQ8HSdrGrYQPLnC3"
song_lookup[song_lookup$Artist=="Kelly Clarkson" & song_lookup$Track=="Wrapped in Red","id"] = "5fclVBnzaGrbucvVMC228o"
song_lookup[song_lookup$Artist=="Lady Gaga" & song_lookup$Track=="The Fame","id"] = "7pMCNNB9wYprg892vwySYC"
song_lookup[song_lookup$Artist=="Lady Gaga" & song_lookup$Track=="Monster","id"] = "1K9jK8EHkgOTjLokIbIxPq"
song_lookup[song_lookup$Artist=="Lady Gaga" & song_lookup$Track=="Born This Way","id"] = "6r2BECwMgEoRb5yLfp0Hca"
song_lookup[song_lookup$Artist=="Lady Gaga" & song_lookup$Track=="ARTPOP","id"] = "73zDQykFwu3yT5VQ6MwYbh"
song_lookup[song_lookup$Artist=="Lady Gaga" & song_lookup$Track=="Joanne","id"] = "2kecdnlyueotEMC8rdNlf6"
song_lookup[song_lookup$Artist=="Mako" & song_lookup$Track=="I Won't Let You Walk Away - Radio Edit","id"] = "02luOsVJEhcVH5Zf3n7Gq6"
song_lookup[song_lookup$Artist=="Molly Sanden" & song_lookup$Track=="Like No One's Watching","id"] = "0seWbF1zqWCa0dkMupdd0S"
song_lookup[song_lookup$Artist=="The Barden Bellas" & song_lookup$Track=="Party In The U.S.A.","id"] = "7c2KF18pPpaN8Hy5MiNNWs"
song_lookup[song_lookup$Artist=="Cardiknox" & song_lookup$Track=="On My Way","id"] = "5spSDPY097Y2PwXQYIFyZb"
song_lookup[song_lookup$Artist=="Selena Gomez & The Scene" & song_lookup$Track=="Naturally","id"] = "1YaVmBh7EAeR54FIjuFcb5"
song_lookup[song_lookup$Artist=="Selena Gomez & The Scene" & song_lookup$Track=="Hit the Lights","id"] = "6ciLLh4TkPYDUfNxn2Z0KO"
song_lookup[song_lookup$Artist=="Elmo & Patsy" & song_lookup$Track=="Grandma Got Run Over By A Reindeer","id"] = "49iHYFjT5yO6WEw6KerX9o"
song_lookup[song_lookup$Artist=="Kelly Clarkson" & song_lookup$Track=="Beautiful Disaster","id"] = "6bcnBvXEsaqFxO5jkgwPwR"
song_lookup[song_lookup$Artist=="Kelly Clarkson" & song_lookup$Track=="Gone","id"] = "5Canmwvufsc7bMM3v2c286"
song_lookup[song_lookup$Artist=="Kool & The Gang" & song_lookup$Track=="Celebration - Single Version","id"] = "3K7Q9PHUWPTaknlbFPThn2"
song_lookup[song_lookup$Artist=="Kool & The Gang" & song_lookup$Track=="Get Down On It","id"] = "4yKZACkuudvfd600H2dQie"
song_lookup[song_lookup$Artist=="Vigiland" & song_lookup$Track=="Shots & Squats - SoMo Vocal Mix","id"] = "40l5cmtb4BpqwNxwrQZkt8"
song_lookup[song_lookup$Artist=="Sia" & song_lookup$Track=="Move Your Body","id"] = "73Mfgc0HTZeNCoNrDI46sJ"
song_lookup[song_lookup$Artist=="Ryn Weaver" & song_lookup$Track=="The Fool","id"] = "5VF6OStYFWd5QTpxTvDXCU"


attributes_lookup = song_lookup
```

#CHECK - No Duplicates
```{r check}
check = attributes_lookup %>%
  group_by(id) %>%
  summarize(count = n()) %>%
  arrange(desc(count))
```

#Look up attributes of songs
```{r attribute lookup}
options(scipen=999)

attributes_lookup$danceability = NA
attributes_lookup$energy = NA
attributes_lookup$key = NA
attributes_lookup$loudness = NA
attributes_lookup$mode = NA
attributes_lookup$speechiness = NA
attributes_lookup$acousticness = NA
attributes_lookup$instrumentalness = NA
attributes_lookup$liveness = NA
attributes_lookup$valence = NA
attributes_lookup$tempo = NA
attributes_lookup$duration_ms = NA
attributes_lookup$time_signature = NA

for(i in seq(1:dim(song_lookup)[1])){
  theLookup = attributes_lookup[i,"id"]
  temp = glue('\'curl -X "GET" "https://api.spotify.com/v1/audio-features/{theLookup}" -H "Accept: application/json" -H "Content-Type: application/json" -H "Authorization: Bearer {OAuth_Token}"\'')
  holder = fromJSON(system(substr(temp,2,nchar(temp)-1),inter=T,ignore.stderr = T))
  attributes_lookup[i,"danceability"] = holder$danceability
  attributes_lookup[i,"energy"] = holder$energy
  attributes_lookup[i,"key"] = holder$key
  attributes_lookup[i,"loudness"] = holder$loudness
  attributes_lookup[i,"mode"] = holder$mode
  attributes_lookup[i,"speechiness"] = holder$speechiness
  attributes_lookup[i,"acousticness"] = holder$acousticness
  attributes_lookup[i,"instrumentalness"] = holder$instrumentalness
  attributes_lookup[i,"liveness"] = holder$liveness
  attributes_lookup[i,"valence"] = holder$valence
  attributes_lookup[i,"tempo"] = holder$tempo
  attributes_lookup[i,"duration_ms"] = holder$duration_ms
  attributes_lookup[i,"time_signature"] = holder$time_signature
}

attributes_lookup$key = as.factor(attributes_lookup$key)
attributes_lookup$mode = as.factor(attributes_lookup$mode)
attributes_lookup$time_signature = as.factor(attributes_lookup$time_signature)
```

#Cluster Songs
```{r clustering}
attrs = attributes_lookup
norm = cbind(as.data.frame(attrs[,c(1:5,10)]),as.data.frame(scale(attrs[,c(6,7,9,11:17)])))
norm$mode = as.numeric(as.character(norm$mode))

plot(norm[,c(6:16)],pch=20)

pcs = princomp(norm[,c(6:16)])
plot(pcs)
plot(pcs, type='l')
summary(pcs)

pcs2 = prcomp(norm[c(6:16)])
comp <- data.frame(pcs2$x[,1:10])
plot(comp, pch=16)

set.seed(412)
km = matrix(nrow=10,ncol=2)
for(i in seq(1:10)){
  kmeans = kmeans(comp,centers = i,iter.max = 1000,nstart=25)
  km[i,1] = i
  km[i,2] = kmeans$tot.withinss
}
km = as.data.frame(km)
colnames(km) = c("Clusters","TotWithinSS")
plot(km$Clusters,km$TotWithinSS,type = "b")

##choose 8
kmeans = kmeans(comp,centers = 8,iter.max = 1000,nstart=25)
norm$cluster = kmeans$cluster
```

#Cluster Plots
```{r cluster plots}
palette(c("blue","green","skyblue","purple","orange","red","gold"))
plot(norm[,c(6:16)],col=norm$cluster,pch=16)

#Less Busy - Only select songs with 50+ plays
norm_subset = norm %>% filter(streams >= 50)
plot(norm_subset[,c(6:16)],col=norm$cluster,pch=16)
```

#Re-attach clusters so non-normalized dataset
```{r reattach}
attrs$cluster = as.factor(norm$cluster)
write.csv(attrs,"song_data.csv",row.names = F)
```

#Plot by Cluster
```{r plots by cluster}
ggplot(attrs, aes(x=cluster, y=danceability,col=cluster)) + 
  geom_boxplot() + 
  scale_color_manual(values=c("deepskyblue","darkorange","firebrick2","blue4","darkorchid3","goldenrod1","green3","brown")) +
  ggtitle("Danceability") + theme(plot.title = element_text(hjust = 0.5))

ggplot(attrs, aes(x=cluster, y=energy,col=cluster)) + 
  geom_boxplot() + 
  scale_color_manual(values=c("deepskyblue","darkorange","firebrick2","blue4","darkorchid3","goldenrod1","green3","brown")) +
  ggtitle("Energy") + theme(plot.title = element_text(hjust = 0.5))

ggplot(attrs, aes(x=cluster, y=loudness,col=cluster)) + 
  geom_boxplot() + 
  scale_color_manual(values=c("deepskyblue","darkorange","firebrick2","blue4","darkorchid3","goldenrod1","green3","brown")) +
  ggtitle("Loudness") + theme(plot.title = element_text(hjust = 0.5))

ggplot(attrs, aes(x=cluster, y=speechiness,col=cluster)) + 
  geom_boxplot() + 
  scale_color_manual(values=c("deepskyblue","darkorange","firebrick2","blue4","darkorchid3","goldenrod1","green3","brown")) +
  ggtitle("Speechiness") + theme(plot.title = element_text(hjust = 0.5))

ggplot(attrs, aes(x=cluster, y=acousticness,col=cluster)) + 
  geom_boxplot() + 
  scale_color_manual(values=c("deepskyblue","darkorange","firebrick2","blue4","darkorchid3","goldenrod1","green3","brown")) +
  ggtitle("Acousticness") + theme(plot.title = element_text(hjust = 0.5))

ggplot(attrs, aes(x=cluster, y=instrumentalness,col=cluster)) + 
  geom_boxplot() + 
  scale_color_manual(values=c("deepskyblue","darkorange","firebrick2","blue4","darkorchid3","goldenrod1","green3","brown")) +
  ggtitle("Instrumentalness") + theme(plot.title = element_text(hjust = 0.5))

ggplot(attrs, aes(x=cluster, y=liveness,col=cluster)) + 
  geom_boxplot() + 
  scale_color_manual(values=c("deepskyblue","darkorange","firebrick2","blue4","darkorchid3","goldenrod1","green3","brown")) +
  ggtitle("Liveness") + theme(plot.title = element_text(hjust = 0.5))

ggplot(attrs, aes(x=cluster, y=valence,col=cluster)) + 
  geom_boxplot() + 
  scale_color_manual(values=c("deepskyblue","darkorange","firebrick2","blue4","darkorchid3","goldenrod1","green3","brown")) +
  ggtitle("Valence") + theme(plot.title = element_text(hjust = 0.5))

ggplot(attrs, aes(x=cluster, y=tempo,col=cluster)) + 
  geom_boxplot() + 
  scale_color_manual(values=c("deepskyblue","darkorange","firebrick2","blue4","darkorchid3","goldenrod1","green3","brown")) +
  ggtitle("Tempo") + theme(plot.title = element_text(hjust = 0.5))
```

#Re-attach cluster information to songs qualifying songs dataset and create times
```{r reattach}
song_final = qsongs %>% left_join(.,attrs,by=c("Artist","Track"))

dtimes = song_final[,"Timestamp"]
dtparts = t(as.data.frame(strsplit(dtimes,' ')))
row.names(dtparts) = NULL

song_final$day = dtparts[,1]
song_final$month = dtparts[,2]
song_final$year = dtparts[,3]
song_final$time = dtparts[,4]
song_final$hour = as.numeric(substr(song_final$time,1,2))
song_final$monthyear = paste(song_final$month,song_final$year,sep=" ")

song_final$quarters = NA
song_final[song_final$monthyear=="Oct 2015" |
           song_final$monthyear=="Nov 2015" |
           song_final$monthyear=="Dec 2015","quarters"] = "2015Q4"
song_final[song_final$monthyear=="Jan 2016" |
           song_final$monthyear=="Feb 2016" |
           song_final$monthyear=="Mar 2016","quarters"] = "2016Q1"
song_final[song_final$monthyear=="Apr 2016" |
           song_final$monthyear=="May 2016" |
           song_final$monthyear=="Jun 2016","quarters"] = "2016Q2"
song_final[song_final$monthyear=="Jul 2016" |
           song_final$monthyear=="Aug 2016" |
           song_final$monthyear=="Sep 2016","quarters"] = "2016Q3"
song_final[song_final$monthyear=="Oct 2016" |
           song_final$monthyear=="Nov 2016" |
           song_final$monthyear=="Dec 2016","quarters"] = "2016Q4"
song_final[song_final$monthyear=="Jan 2016" |
           song_final$monthyear=="Feb 2016" |
           song_final$monthyear=="Mar 2017","quarters"] = "2017Q1"
song_final[song_final$monthyear=="Apr 2017" |
           song_final$monthyear=="May 2017" |
           song_final$monthyear=="Jun 2017","quarters"] = "2017Q2"
song_final[song_final$monthyear=="Jul 2017" |
           song_final$monthyear=="Aug 2017" |
           song_final$monthyear=="Sep 2017","quarters"] = "2017Q3"
song_final[song_final$monthyear=="Oct 2017" |
           song_final$monthyear=="Nov 2017" |
           song_final$monthyear=="Dec 2017","quarters"] = "2017Q4"
song_final[song_final$monthyear=="Jan 2018" |
           song_final$monthyear=="Feb 2018" |
           song_final$monthyear=="Mar 2018","quarters"] = "2018Q1"
song_final[song_final$monthyear=="Apr 2018" |
           song_final$monthyear=="May 2018" |
           song_final$monthyear=="Jun 2018","quarters"] = "2018Q2"
song_final[song_final$monthyear=="Jul 2018" |
           song_final$monthyear=="Aug 2018" |
           song_final$monthyear=="Sep 2018","quarters"] = "2018Q3"
song_final[song_final$monthyear=="Oct 2018" |
           song_final$monthyear=="Nov 2018" |
           song_final$monthyear=="Dec 2018","quarters"] = "2018Q4"
song_final[song_final$monthyear=="Jan 2019" |
           song_final$monthyear=="Feb 2019" |
           song_final$monthyear=="Mar 2019","quarters"] = "2019Q1"
song_final[song_final$monthyear=="Apr 2019" |
           song_final$monthyear=="May 2019" |
           song_final$monthyear=="Jun 2019","quarters"] = "2019Q2"
song_final[song_final$monthyear=="Jul 2019" |
           song_final$monthyear=="Aug 2019" |
           song_final$monthyear=="Sep 2019","quarters"] = "2019Q3"
song_final[song_final$monthyear=="Oct 2019" |
           song_final$monthyear=="Nov 2019" |
           song_final$monthyear=="Dec 2019","quarters"] = "2019Q4"
song_final$monthyear = as.yearmon(paste(song_final$month,substr(song_final$year,3,4),sep="-"),"%b-%y")
song_final$count = 1

write.csv(song_final,"song_final.csv",row.names = F)
```

#Lets make some plots
```{r lets make some plots}
#create table with cluster counts
cluster_counts = as.data.frame(matrix(NA,nrow=8,ncol=3))
colnames(cluster_counts) = c("cluster","songs","totalsongs")
for(i in seq(1:8)){
  cluster_counts[i,"cluster"] = i
  cluster_counts[i,"songs"] = dim(attrs[attrs$cluster==i,"Track"])[1]
  cluster_counts[i,"totalsongs"] = 1437
}
cluster_counts$cluster = as.factor(cluster_counts$cluster)

listening_trends = song_final %>%
  filter(is.na(quarters) == F)

#total listening
total_listening = listening_trends %>%
  group_by(quarters) %>%
  summarise(total_streams = n())

#listening by cluster
listening_by_cluster = listening_trends %>%
  group_by(quarters,cluster) %>%
  summarise(streams = n()) %>%
  left_join(.,total_listening,by="quarters") %>%
  left_join(.,cluster_counts,by="cluster") %>%
  mutate(percent = streams/total_streams,
         index = streams/(total_streams*(songs/totalsongs))*100) %>%
  select(-c("total_streams","songs","totalsongs"))

#listening by major artists
artist_total = song_final %>%
  group_by(Artist) %>%
  summarise(total_artist_streams = n()) %>%
  arrange(desc(total_artist_streams))

top_artists = artist_total %>% filter(total_artist_streams >= 300)

artist_quarterly = song_final %>%
  filter(is.na(quarters) == F) %>%
  group_by(quarters,Artist) %>%
  summarise(streams = n()) %>%
  inner_join(.,top_artists,by="Artist") %>%
  left_join(.,total_listening,by="quarters") %>%
  mutate(percent=streams/total_streams*100) %>%
  select(c("Artist","quarters","streams","percent")) %>%
  arrange(Artist,quarters)

#listening by top tracks
track_total = song_final %>%
  group_by(Artist,Track,cluster) %>%
  summarise(total_track_streams = n()) %>%
  arrange(desc(total_track_streams))

top_tracks = track_total %>% filter(total_track_streams >= 300)

track_quarterly = song_final %>%
  filter(is.na(quarters) == F) %>%
  group_by(quarters,Artist,Track) %>%
  summarise(streams = n()) %>%
  inner_join(.,top_tracks,by=c("Artist","Track")) %>%
  left_join(.,total_listening,by="quarters") %>%
  mutate(percent=streams/total_streams*100,
         ArtistTrack = paste(Artist,Track,sep=" - ")) %>%
  select(c("Artist","ArtistTrack","quarters","streams","percent")) %>%
  arrange(ArtistTrack,quarters)

write.csv(total_listening,"Output_Files/total_listening_trends.csv")
write.csv(listening_by_cluster,"Output_Files/cluster_listening_trends.csv")
write.csv(artist_quarterly,"Output_Files/artist_listening_trends.csv")
write.csv(track_quarterly,"Output_Files/track_listening_trends.csv")
write.csv(artist_total,"Output_Files/artist.csv")
write.csv(track_total,"Output_Files/tracks.csv")
```

